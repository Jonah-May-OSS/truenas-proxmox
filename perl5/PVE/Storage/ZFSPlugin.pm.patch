@@
 use PVE::Storage::LunCmd::Comstar;
+use PVE::Storage::LunCmd::TrueNAS;
@@
     list_view   => 1,
+    list_extent => 1,
@@
     if ($scfg->{iscsiprovider} eq 'comstar') {
         return PVE::Storage::LunCmd::Comstar::get_base;
+    } elsif ($scfg->{iscsiprovider} eq 'truenas') {
+        return PVE::Storage::LunCmd::TrueNAS::get_base;
@@
-        } elsif ($scfg->{iscsiprovider} eq 'istgt') {
+        } elsif ($scfg->{iscsiprovider} eq 'truenas') {
+            $msg = PVE::Storage::LunCmd::TrueNAS::run_lun_command($scfg, $timeout, $method, @params);
+        } elsif ($scfg->{iscsiprovider} eq 'istgt') {
@@
         iscsiprovider => {
             description => "iscsi provider",
             type        => 'string',
-    },
+    },
+
+    # — TrueNAS API integration —
+    truenas_user       => { description => "TrueNAS API Username",      type => 'string',      optional => 1 },
+    truenas_secret     => { description => "TrueNAS API Secret",        type => 'string',      format => 'password', optional => 1 },
+    truenas_token_auth => { description => "Use token (Bearer) auth",   type => 'boolean',     default => 0,           optional => 1 },
+    truenas_use_ssl    => { description => "Connect via HTTPS",         type => 'boolean',     default => 1,           optional => 1 },
+    truenas_apiv4_host => { description => "API host override",         type => 'string',      optional => 1 },
